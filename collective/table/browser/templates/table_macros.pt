<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal"
     xmlns:i18n="http://xml.zope.org/namespaces/i18n"
     i18n:domain="collective.table"
     tal:omit-tag="">

<tal:if condition="fieldName|nothing"><!-- only use when viewing widgets -->
<metal:view_macro define-macro="view">
    <!-- <a onclick="fnClickAddRow();" href="javascript:void(0);">Click to add a new row</a> -->
    <button id="btnAddNewRow">Add</button>
    
    <!-- <div class="add_delete_toolbar" /> -->
    <table id="field-table-datagrid" class="dataTables listing nosort" 
           tal:attributes="id string:$fieldName-table-datagrid">
      <tbody>
      </tbody>
    </table>
    <script type="text/javascript" charset="utf-8"
            tal:define="view python:path('nocall:context/@@collective.table.widgets/%s' % fieldName)"
            tal:content="view/tableinit"></script>
            
    <form id="formAddNewRow" action="#" title="Add new row">
        <label for="name">Name</label><input type="text" name="name" id="name" class="required" rel="0" />
        <br />
        <label for="name">Address</label><input type="text" name="address" id="address" rel="1" />
        <br />
        <label for="name">Postcode</label><input type="text" name="postcode" id="postcode"/>
        <br />
        <label for="name">Town</label><input type="text" name="town" id="town" rel="2" />
        <br />
    </form>
</metal:view_macro>

<metal:edit_macro define-macro="edit">
<metal:use use-macro="field_macro | context/widgets/field/macros/edit">
<div metal:fill-slot="widget_body" tal:define="
    view python:path('nocall:context/@@collective.table.widgets/%s' % fieldName);
    sources view/availableSources">

  <tal:if condition="python:len(sources) > 1">
  <label i18n:translate="label_datasource">Data Source</label>
  <div class="formHelp">Select a source for the data table information.</div>
  <div class="dataTable-selectSourceName" tal:repeat="source sources">
      <input type="radio" name="field.sourceName" id="dataTable-sourceName-id"
             class="noborder blurrable"
          tal:attributes="
              name string:$fieldName.sourceName;
              id string:dataTable-sourceName-$fieldName-${source/id};
              value source/id;
              checked python:source['selected'] or None;"
          />
      <label for="dataTable-sourceName-id" tal:attributes="
             for string:dataTable-sourceName-$fieldName-${source/id}"
             tal:content="source/title">Source Title</label>
      <div class="dataTable-selectSourceName-help" tal:content="source/description">
          Longer source description
      </div>
  </div>
  </tal:if>

  <tal:comment condition="python:False">
    XXX: the following is going to be replaced by per-source configuration.
    This is a simple form to configure a local source, when we have multiple
    source implementations each source will provide a form in a pop-up, or
    in case of only one registered source, an inlined form right here.
  </tal:comment>
  <label for="dataTable-local-columns-id" tal:attributes="
         for string:dataTable-local-columns-$fieldName"
         i18n:translate="label_local_columns">Table columns</label><br/>
  <textarea class="bularrable firstToFocus" cols="40" rows="5" name=""
    id="dataTable-local-columns-id"
    tal:attributes="name string:$fieldName.local.columns:ustring;
                    id string:dataTable-local-columns-$fieldName"
    tal:content="python:'\n'.join(c['title'] for c in view.source.listColumns())">
  </textarea>

  <input name="" value="__ignored__" type="hidden"
        tal:attributes="name fieldName"/>
</div>
</metal:use>
</metal:edit_macro>


<metal:hidden_macro define-macro="hidden">
  <input name="" value="__ignored__" type="hidden"
         tal:attributes="name fieldName;" />
</metal:hidden_macro>
</tal:if>

</html>
